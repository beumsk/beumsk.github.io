(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[412],{1738:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/blog/generate-a-sitemap-in-nextjs",function(){return n(9595)}])},4152:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var s=n(5893),r=n(9786);function i(e){var t=e.className,n=e.sandbox,i=e.title;return(0,s.jsx)(s.Fragment,{children:(0,s.jsx)("div",{className:"code-iframe-wrapper "+(t||""),children:(0,s.jsx)("iframe",{height:"300",title:i,loading:"lazy",src:"https://codesandbox.io/embed/"+n+"?fontsize=14&theme=dark",sandbox:"allow-forms allow-modals allow-popups allow-presentation allow-same-origin allow-scripts",children:(0,s.jsx)(r.Z,{href:"https://codesandbox.io/s/"+n,children:"See the Sandbox by R\xe9my Beumier"})})})})}},9595:function(e,t,n){"use strict";n.r(t);var s=n(5893),r=n(1151),i=n(4911),o=n(9786),a=n(4152),c=function(e){var t=e.children;return(0,s.jsx)(i.Z,{children:t})};function l(e){var t=Object.assign({p:"p",code:"code",h2:"h2",pre:"pre",strong:"strong"},(0,r.ah)(),e.components);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.p,{children:"Sitemaps are important for web crawlers such as google bots, and therefore we need one to improve our site's SEO."}),"\n",(0,s.jsxs)(t.p,{children:["Sadly, Next.js does not provide a go-to option regarding sitemap and I find the external libraries too limited. I tested ",(0,s.jsx)(t.code,{children:"nextjs-sitemap-generator"}),", but I couldn't make it define the ",(0,s.jsx)(t.code,{children:"lastmod"})," or ",(0,s.jsx)(t.code,{children:"changefreq"})," with precision."]}),"\n",(0,s.jsxs)(t.p,{children:["I decided to create something custom and firstly tried to make something with a ",(0,s.jsx)(t.code,{children:"sitemap.xml.js"})," page. It wasn't a success because I couldn't make it an .xml file."]}),"\n",(0,s.jsxs)(t.p,{children:["I went a different way and built a ",(0,s.jsx)(t.code,{children:".mjs"})," file with the purpose of creating my ",(0,s.jsx)(t.code,{children:"sitemap.xml"}),". It uses Node's file creation, ",(0,s.jsx)(t.code,{children:"Globby"})," to crawl files and ",(0,s.jsx)(t.code,{children:"Prettier"})," to format it."]}),"\n",(0,s.jsx)(t.p,{children:"Let's walk through the steps of creating our custom sitemap generator together."}),"\n",(0,s.jsx)(t.h2,{children:"First version"}),"\n",(0,s.jsxs)(t.p,{children:["We want to make sure the ",(0,s.jsx)(t.code,{children:".mjs"})," script creates the sitemap.xml. We will achieve this with Node."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-js",children:"import { writeFileSync } from 'fs';\n\nasync function generate() {\n  const prettierConfig = await prettier.resolveConfig('./.prettierrc.js');\n  const pages = ['', 'about', 'contact'];\n  const baseUrl = 'https://your-url.com';\n  const sitemap = `\n    <?xml version=\"1.0\" encoding=\"UTF-8\"?>\n    <urlset xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n      xsi:schemaLocation=\"http://www.sitemaps.org/schemas/sitemap/0.9 http://www.sitemaps.org/schemas/sitemap/0.9/sitemap.xsd\"\n      xmlns=\"http://www.sitemaps.org/schemas/sitemap/0.9\">\n      ${pages\n        .map((page) => {\n          return `\n            <url>\n              <loc>${baseUrl}/${path}</loc>\n              <changefreq>monthly</changefreq>\n            </url>\n          `;\n        })\n        .join('')}\n    </urlset>\n  `;\n\n  writeFileSync('public/sitemap.xml', formatted);\n}\n\ngenerate();\n"})}),"\n",(0,s.jsxs)(t.p,{children:["If you don't know much about the topic, ",(0,s.jsx)(o.Z,{href:"https://sitemaps.org/protocol.html",children:"read more about the sitemap protocol"}),"."]}),"\n",(0,s.jsx)(t.h2,{children:"Focus on the files you want in the sitemap"}),"\n",(0,s.jsxs)(t.p,{children:["We now want something that actually represents our website content. We will do that with ",(0,s.jsx)(t.code,{children:"Globby"})," and we will fix the code format with ",(0,s.jsx)(t.code,{children:"Prettier"}),"."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-js",children:"import { writeFileSync } from 'fs';\nimport { globby } from 'globby';\nimport prettier from 'prettier';\nasync function generate() {\n  const prettierConfig = await prettier.resolveConfig('./.prettierrc.js');\n  const pages = await globby(\n    [\n      // we list all .js files under /pages\n      'pages/*.js',\n      // we could add more specific files to the list such as .md\n    ],\n    // this line gets us more data check the doc: https://nodejs.org/api/fs.html#class-fsstats\n    { stats: true }\n  );\n  const baseUrl = 'https://your-url.com';\n  const sitemap = `\n    <?xml version=\"1.0\" encoding=\"UTF-8\"?>\n    <urlset xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n      xsi:schemaLocation=\"http://www.sitemaps.org/schemas/sitemap/0.9 http://www.sitemaps.org/schemas/sitemap/0.9/sitemap.xsd\"\n      xmlns=\"http://www.sitemaps.org/schemas/sitemap/0.9\">\n      ${pages\n        .map((page) => {\n          const path = page.path.replace('pages/', '').replace('index', '').replace('.js', '');\n\n          return `\n            <url>\n              <loc>${baseUrl}/${path}</loc>\n              <lastmod>${page.stats.mtime}</lastmod>\n              <changefreq>monthly</changefreq>\n            </url>\n          `;\n        })\n        .join('')}\n    </urlset>\n  `;\n\n  const formatted = prettier.format(sitemap, {\n    ...prettierConfig,\n    parser: 'html',\n  });\n\n  writeFileSync('public/sitemap.xml', formatted);\n}\n\ngenerate();\n"})}),"\n",(0,s.jsxs)(t.p,{children:["We have something working but still too generic, especially the ",(0,s.jsx)(t.code,{children:"changefreq"})," and the missing ",(0,s.jsx)(t.code,{children:"priority"}),"."]}),"\n",(0,s.jsx)(t.h2,{children:"Improve the logic based on your needs"}),"\n",(0,s.jsx)(t.p,{children:"From this point, we want every entry of our sitemap to reflect its content. Let's add some function logic for this purpose."}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-js",children:"import { writeFileSync } from 'fs';\nimport { globby } from 'globby';\nimport prettier from 'prettier';\n\nasync function generate() {\n  const prettierConfig = await prettier.resolveConfig('./.prettierrc.js');\n  const pages = await globby(['pages/*.js'], { stats: true });\n  const baseUrl = 'https://your-url.com';\n\n  const sitemap = `\n    <?xml version=\"1.0\" encoding=\"UTF-8\"?>\n    <urlset xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n      xsi:schemaLocation=\"http://www.sitemaps.org/schemas/sitemap/0.9 http://www.sitemaps.org/schemas/sitemap/0.9/sitemap.xsd\"\n      xmlns=\"http://www.sitemaps.org/schemas/sitemap/0.9\">\n\n      ${pages\n        .map((page) => {\n          const path = page.path.replace('pages/', '').replace('index', '').replace('.js', '');\n\n          return `\n            <url>\n              <loc>${baseUrl}/${path}</loc>\n              <lastmod>${convertDate(page.stats.mtime)}</lastmod>\n              <changefreq>${changefreq(path)}</changefreq>\n              <priority>${priority(path)}</priority>\n            </url>\n          `;\n        })\n        .join('')}\n    </urlset>\n    `;\n\n  const formatted = prettier.format(sitemap, {\n    ...prettierConfig,\n    parser: 'html',\n  });\n\n  writeFileSync('public/sitemap.xml', formatted);\n}\n\ngenerate();\n\nfunction priority(path) {\n  switch (path) {\n    case '':\n      return '1.0';\n    case 'about':\n      return '0.8';\n    default:\n      return '0.6';\n  }\n}\n\nfunction changefreq(path) {\n  switch (path) {\n    case '':\n      return 'weekly';\n    case 'about':\n      return 'monthly';\n    default:\n      return 'yearly';\n  }\n}\n\n// convert date to format yyyy-mm-dd\nfunction convertDate(inputFormat) {\n  function pad(s) {\n    return s < 10 ? '0' + s : s;\n  }\n  var d = new Date(inputFormat);\n  return [d.getFullYear(), pad(d.getMonth() + 1), pad(d.getDate())].join('-');\n}\n"})}),"\n",(0,s.jsxs)(t.p,{children:["We have built a complete sitemap with specific URL, last modification date, change frequency and priority.\nCheck out ",(0,s.jsx)(o.Z,{href:"https://github.com/sindresorhus/globby",children:"the globby documentation for more possibilities"}),"."]}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"TLDR"}),": ",(0,s.jsx)(o.Z,{href:"https://codesandbox.io/s/custom-sitemap-i3jvko",children:"Codesandbox: Custom sitemap in Next.js"}),"."]}),"\n",(0,s.jsx)(a.Z,{sandbox:"custom-sitemap-i3jvko",title:"Custom sitemap in Next.js"}),"\n",(0,s.jsx)(t.p,{children:"Would you improve this code or do it in another way? Don't hesitate to share your ideas!"}),"\n",(0,s.jsx)(t.p,{children:"Enjoy coding with Next.js!"})]})}t.default=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,s.jsx)(c,Object.assign({},e,{children:(0,s.jsx)(l,e)}))}}},function(e){e.O(0,[838,151,365,594,805,136,911,774,888,179],(function(){return t=1738,e(e.s=t);var t}));var t=e.O();_N_E=t}]);